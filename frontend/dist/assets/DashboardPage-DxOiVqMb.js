var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,n=(t,s,r)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r;import{r as o,j as d}from"./vendor-D1DNIM4c.js";import{a as i,D as u}from"./attendanceServices-M_sHIxjr.js";import"./index-B9AZMt1L.js";import{s as c,j as m,p as x,t as b,U as h,u as g,v as f}from"./ui-CfGEgmeW.js";const p=e=>{if(!e)return"-";try{if(e instanceof Date)return u.fromJSDate(e).setZone("Asia/Colombo").toLocaleString(u.TIME_WITH_SECONDS);const t=u.fromISO(e);return t.isValid?t.setZone("Asia/Colombo").toLocaleString(u.TIME_WITH_SECONDS):u.fromJSDate(new Date(e)).setZone("Asia/Colombo").toLocaleString(u.TIME_WITH_SECONDS)}catch(t){return"-"}},j=e=>{if(!e)return"px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200";const t="px-2.5 py-0.5 rounded-full text-xs font-medium",s=e.toLowerCase();return"present"===s||"entered"===s?`${t} bg-gradient-to-r from-green-100 to-green-200 dark:from-green-800 dark:to-green-900 text-green-800 dark:text-green-100`:"left"===s?`${t} bg-gradient-to-r from-blue-100 to-blue-200 dark:from-blue-800 dark:to-blue-900 text-blue-800 dark:text-blue-100`:"late"===s?`${t} bg-gradient-to-r from-yellow-100 to-yellow-200 dark:from-yellow-800 dark:to-yellow-900 text-yellow-800 dark:text-yellow-100`:"absent"===s?`${t} bg-gradient-to-r from-red-100 to-red-200 dark:from-red-800 dark:to-red-900 text-red-800 dark:text-red-100`:`${t} bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200`},v=({title:e,count:t,total:s,color:r,icon:a})=>d.jsx("div",{className:"bg-gradient-to-br from-white to-blue-50 dark:from-slate-800 dark:to-slate-900 p-6 rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 border border-blue-100 dark:border-slate-700",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:e}),d.jsxs("p",{className:"text-3xl font-bold text-gray-900 dark:text-white mt-2",children:[d.jsx("span",{className:`text-${r}-600 dark:text-${r}-400`,children:t}),void 0!==s&&d.jsxs("span",{className:"text-gray-400 dark:text-gray-500 text-lg ml-1",children:["/ ",s]})]})]}),d.jsx("div",{className:`p-3.5 rounded-full bg-gradient-to-br from-${r}-400 to-${r}-500 dark:from-${r}-600 dark:to-${r}-700 text-white`,children:a})]})}),y=({searchQuery:e,setSearchQuery:t,activeTab:s,setActiveTab:r})=>d.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[d.jsxs("div",{className:"relative flex-grow",children:[d.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:d.jsx(g,{className:"h-5 w-5 text-blue-400"})}),d.jsx("input",{type:"text",placeholder:"Search students...",value:e,onChange:e=>t(e.target.value),className:"pl-10 w-full px-4 py-2 border border-blue-200 dark:border-blue-800 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-slate-800 dark:text-white shadow-sm"})]}),d.jsxs("div",{className:"flex bg-white dark:bg-slate-800 rounded-lg border border-blue-200 dark:border-blue-800",children:[d.jsx("button",{onClick:()=>r("present"),className:"px-4 py-2 rounded-l-lg transition-colors duration-150 "+("present"===s?"bg-blue-500 text-white font-medium":"text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20"),children:"Present"}),d.jsx("button",{onClick:()=>r("left"),className:"px-4 py-2 rounded-r-lg transition-colors duration-150 "+("left"===s?"bg-blue-500 text-white font-medium":"text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20"),children:"Left"})]})]}),N=()=>{const[e,t]=o.useState(u.now().setZone("Asia/Colombo"));return o.useEffect((()=>{const e=setInterval((()=>{t(u.now().setZone("Asia/Colombo"))}),1e3);return()=>clearInterval(e)}),[]),d.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-slate-700",children:[d.jsxs("div",{className:"flex justify-between items-center mb-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:"Current Time"}),d.jsx(x,{className:"h-5 w-5 text-blue-500"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-4xl font-bold text-blue-600 dark:text-blue-400 mb-2",children:e.toFormat("hh:mm:ss a")}),d.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.toFormat("EEEE, MMMM d, yyyy")})]})]})},w=({presentCount:e,leftCount:t})=>{const s=e+t,r=s>0?Math.round(e/s*100):0,a=s>0?Math.round(t/s*100):0,l=2*Math.PI*64,n=r/100*l;return d.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-slate-700 hover:shadow-xl transition-all duration-300",children:[d.jsxs("div",{className:"flex justify-between items-center mb-6",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:"Attendance Distribution"}),d.jsx(f,{className:"h-5 w-5 text-blue-500 animate-pulse"})]}),d.jsx("div",{className:"flex items-center justify-center mb-6 relative group",children:d.jsxs("div",{className:"relative w-40 h-40",children:[d.jsxs("svg",{className:"w-full h-full -rotate-90 transform",viewBox:"0 0 144 144",children:[d.jsx("circle",{cx:"72",cy:"72",r:"64",className:"fill-none stroke-blue-100 dark:stroke-blue-900/30",strokeWidth:"16"}),d.jsx("circle",{cx:"72",cy:"72",r:"64",className:"fill-none stroke-green-500 dark:stroke-green-600 transition-all duration-700 ease-in-out",strokeWidth:"16",strokeDasharray:`${n} ${l}`,strokeLinecap:"round",style:{transform:"rotate(-90deg)",transformOrigin:"50% 50%",transition:"stroke-dasharray 1s ease-in-out"}})]}),d.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:d.jsxs("div",{className:"text-center group-hover:scale-110 transition-transform duration-200",children:[d.jsx("span",{className:"text-3xl font-bold text-gray-700 dark:text-gray-300",children:s}),d.jsx("span",{className:"block text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Total"})]})}),d.jsx("div",{className:"absolute inset-0 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-200 bg-gradient-to-b from-white/5 to-transparent pointer-events-none"})]})}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsxs("div",{className:"text-center p-3 rounded-lg bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 group hover:scale-105 transition-transform duration-200",children:[d.jsxs("div",{className:"flex items-center justify-center mb-2",children:[d.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-2 group-hover:animate-pulse"}),d.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Present"})]}),d.jsxs("p",{className:"text-xl font-bold text-green-600 dark:text-green-400",children:[e,d.jsxs("span",{className:"text-sm ml-1 text-green-500/70",children:["(",r,"%)"]})]})]}),d.jsxs("div",{className:"text-center p-3 rounded-lg bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 group hover:scale-105 transition-transform duration-200",children:[d.jsxs("div",{className:"flex items-center justify-center mb-2",children:[d.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-2 group-hover:animate-pulse"}),d.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Left"})]}),d.jsxs("p",{className:"text-xl font-bold text-blue-600 dark:text-blue-400",children:[t,d.jsxs("span",{className:"text-sm ml-1 text-blue-500/70",children:["(",a,"%)"]})]})]})]})]})},k=({student:e})=>{var t;return d.jsxs("div",{className:"flex items-start space-x-4 p-4 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors duration-150",children:[d.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-gradient-to-br from-blue-500 to-indigo-600 dark:from-blue-600 dark:to-indigo-700 rounded-full flex items-center justify-center text-white font-medium shadow-md",children:e.name.substring(0,1)}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsxs("div",{className:"flex justify-between items-start",children:[d.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:e.name}),d.jsx("span",{className:j(e.status),children:e.displayStatus})]}),d.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400 mt-1",children:[d.jsx("span",{className:"font-mono",children:e.indexNumber}),d.jsx("span",{className:"mx-2",children:"â€¢"}),d.jsxs("div",{className:"flex items-center",children:[(e=>{if(!e)return d.jsx(x,{className:"h-4 w-4 text-gray-400"});const t=e.toLowerCase();return"present"===t||"entered"===t?d.jsx(m,{className:"h-4 w-4 text-green-500"}):"left"===t?d.jsx(b,{className:"h-4 w-4 text-blue-500"}):d.jsx(x,{className:"h-4 w-4 text-gray-400"})})(e.status),d.jsx("span",{className:"ml-1",children:"left"===(null==(t=e.status)?void 0:t.toLowerCase())?p(e.leaveTime):p(e.entryTime)})]})]})]})]})},C=({students:e,loading:t,activeTab:s})=>{if(t)return d.jsx("div",{className:"flex justify-center py-8",children:d.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-200 dark:border-blue-700 border-t-blue-600 dark:border-t-blue-400"})});if(!e.length){const e="present"===s?"No students currently present":"No students have left yet",t="present"===s?"Students will appear here when they check in":"Students who leave will appear here",r="present"===s?d.jsx(m,{className:"mx-auto h-12 w-12 text-green-300 dark:text-green-700"}):d.jsx(b,{className:"mx-auto h-12 w-12 text-blue-300 dark:text-blue-700"});return d.jsxs("div",{className:"text-center py-16 bg-gradient-to-b from-white to-blue-50 dark:from-slate-800 dark:to-slate-900 rounded-lg border border-blue-100 dark:border-blue-900",children:[r,d.jsx("p",{className:"mt-4 text-blue-600 dark:text-blue-400 font-medium",children:e}),d.jsx("p",{className:"text-blue-400 dark:text-blue-500 text-sm mt-1",children:t})]})}const r="present"===s?"Present Students":"Left Students",a="present"===s?d.jsx(m,{className:"h-5 w-5 text-green-500"}):d.jsx(b,{className:"h-5 w-5 text-blue-500"});return d.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-lg border border-gray-200 dark:border-slate-700",children:[d.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200 dark:border-slate-700",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:r}),a]}),d.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700 max-h-[500px] overflow-y-auto",children:e.map((e=>d.jsx(k,{student:e},e.uniqueKey)))})]})},S=()=>{const[e,u]=o.useState({totalStudents:0,presentCount:0,leftCount:0,absentCount:0,lateCount:0}),[x,g]=o.useState([]),[f,p]=o.useState(!1),[j,k]=o.useState(null),[S,T]=o.useState(""),[L,A]=o.useState("present"),D=o.useCallback((()=>{return e=void 0,o=null,d=function*(){try{if(!localStorage.getItem("token")&&!sessionStorage.getItem("token"))return;p(!0),k(null);const e=yield i.getRecentAttendance();if(!e||!e.students&&!e.stats)return g([]),void u({totalStudents:0,presentCount:0,leftCount:0,absentCount:0,lateCount:0});const{students:o=[],stats:d={}}=e,c=o.map((e=>{const o=e._id||e.id||Math.random().toString(36).substring(7);try{let u=null;const c=(new Date).toISOString().split("T")[0];(null==e?void 0:e.attendanceHistory)&&Array.isArray(e.attendanceHistory)&&(u=e.attendanceHistory.find((e=>e.date&&e.date.startsWith(c))));let m=null,x=null;u&&(m=u.entryTime,x=u.leaveTime);let b=e.status,h=e.status;if(u&&(h=u.status,h)){const e=h.toLowerCase();b="entered"===e?"Present":"left"===e?"Left":h.charAt(0).toUpperCase()+h.slice(1)}const g=e.firstName&&e.lastName?`${e.firstName} ${e.lastName}`:e.name||"Unknown Student",f=e.student_email||e.email||null;return d=((e,t)=>{for(var s in t||(t={}))a.call(t,s)&&n(e,s,t[s]);if(r)for(var s of r(t))l.call(t,s)&&n(e,s,t[s]);return e})({},e),i={uniqueKey:o,name:g,email:f,student_email:e.student_email,displayStatus:b,status:h,entryTime:m,leaveTime:x,timestamp:m?new Date(m).getTime():0},t(d,s(i))}catch(u){return{uniqueKey:o,name:e.name||e.firstName||"Unknown Student",indexNumber:e.indexNumber||"N/A",status:e.status||"Unknown",displayStatus:e.status||"Unknown",entryTime:null,leaveTime:null,timestamp:0,_id:e._id||e.id}}var d,i})),m=c.filter((e=>{var t;const s=null==(t=e.status)?void 0:t.toLowerCase();return"present"===s||"entered"===s})),x=c.filter((e=>{var t;return"left"===(null==(t=e.status)?void 0:t.toLowerCase())})),b=m.sort(((e,t)=>t.timestamp-e.timestamp)),h=x.sort(((e,t)=>{const s=e.leaveTime?new Date(e.leaveTime).getTime():0;return(t.leaveTime?new Date(t.leaveTime).getTime():0)-s})),f=[...b,...h];g(f),u({totalStudents:d.totalCount||c.length||0,presentCount:d.presentCount||m.length||0,leftCount:d.leftCount||x.length||0,absentCount:d.absentCount||0,lateCount:d.lateCount||0})}catch(e){k("Failed to load dashboard data"),g([]),u({totalStudents:0,presentCount:0,leftCount:0,absentCount:0,lateCount:0})}finally{p(!1)}},new Promise(((t,s)=>{var r=e=>{try{l(d.next(e))}catch(t){s(t)}},a=e=>{try{l(d.throw(e))}catch(t){s(t)}},l=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,a);l((d=d.apply(e,o)).next())}));var e,o,d}),[]),I=o.useMemo((()=>x.filter((e=>{var t,s,r,a;const l=null==(t=e.status)?void 0:t.toLowerCase(),n="present"===L?"present"===l||"entered"===l:"left"===l,o=((null==(s=e.name)?void 0:s.toLowerCase())||"").includes(S.toLowerCase())||((null==(r=e.indexNumber)?void 0:r.toLowerCase())||"").includes(S.toLowerCase())||((null==(a=e.student_email)?void 0:a.toLowerCase())||"").includes(S.toLowerCase());return n&&o}))),[x,L,S]),O={total:d.jsx(h,{className:"h-6 w-6 text-white"}),present:d.jsx(m,{className:"h-6 w-6 text-white"}),left:d.jsx(b,{className:"h-6 w-6 text-white"}),absent:d.jsx(c,{className:"h-6 w-6 text-white"})};o.useEffect((()=>{D();const e=setInterval(D,3e4);return()=>clearInterval(e)}),[D]);const $=e.presentCount>0||e.leftCount>0;return d.jsx("div",{className:"min-h-screen bg-transparent",children:d.jsxs("div",{className:"container mx-auto px-4 py-8",children:[d.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4 mb-8",children:[d.jsx("h1",{className:"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-blue-800",children:"Attendance Dashboard"}),d.jsx(N,{})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10",children:[d.jsx(v,{title:"Total Students",count:e.totalStudents,color:"blue",icon:O.total}),d.jsx(v,{title:"Present",count:e.presentCount,total:e.totalStudents,color:"green",icon:O.present}),d.jsx(v,{title:"Left",count:e.leftCount,total:e.totalStudents,color:"blue",icon:O.left}),d.jsx(v,{title:"Absent",count:e.absentCount,total:e.totalStudents,color:"red",icon:O.absent})]}),j&&d.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-4 mb-6 rounded-md",children:d.jsxs("div",{className:"flex",children:[d.jsx("div",{className:"flex-shrink-0",children:d.jsx(c,{className:"h-5 w-5 text-red-400"})}),d.jsx("div",{className:"ml-3",children:d.jsx("p",{className:"text-sm text-red-700",children:j})})]})}),$?d.jsxs(d.Fragment,{children:[d.jsx(y,{searchQuery:S,setSearchQuery:T,activeTab:L,setActiveTab:A}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[d.jsx(w,{presentCount:e.presentCount,leftCount:e.leftCount}),d.jsx(C,{students:I,loading:f,activeTab:L})]})]}):d.jsxs("div",{className:"text-center py-16 bg-gradient-to-b from-white to-blue-50 dark:from-slate-800 dark:to-slate-900 rounded-xl shadow-lg border border-blue-100 dark:border-blue-900 mb-6",children:[d.jsx("div",{className:"bg-blue-100 dark:bg-blue-900/30 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4",children:d.jsx(m,{className:"h-10 w-10 text-blue-500 dark:text-blue-400"})}),d.jsx("h3",{className:"text-xl font-semibold text-blue-600 dark:text-blue-400",children:"No Activity Yet"}),d.jsx("p",{className:"text-blue-400 dark:text-blue-500 text-sm mt-1 max-w-md mx-auto",children:"The dashboard will display attendance information when students start checking in."})]})]})})};export{S as default};
